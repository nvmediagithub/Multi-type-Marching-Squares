# Multi-type Marching Squares с розовой спорной зоной

## Оглавление

* [Описание](#Описание)
* [Теория](#Теория)

  * [Алгоритм Marching Squares](#Алгоритм-Marching-Squares)
  * [Мульти-типовая версия](#Мульти-типовая-версия)
  * [Спорные зоны (aband)](#Спорные-зоны-aband)
* [Установка и запуск](#Установка-и-запуск)
* [Структура проекта](#Структура-проекта)
* [Примеры использования](#Примеры-использования)
* [Управление](#Управление)
* [Скриншоты](#Скриншоты)
* [Лицензия](#Лицензия)

## Описание

Этот проект реализует визуализацию адаптированного алгоритма **Marching Squares**, где каждая вершина квадрата может принимать **четыре состояния** (T=4), а также выделяются **спорные области** (pink ambiguous regions) при неоднозначном распределении состояний.

Из достоинств:

* Универсальная таблица для T^4 комбинаций состояний вершин.
* Плавная интерполяция на рёбрах на основе весов вершин.
* Отображение основных поверхностей 0..3 и спорной области.
* Интерактивное управление состояниями вершин и их весами.

## Теория

### Нумерация вершин и рёбер

Нумерация вершин квадрата выполняется по часовой стрелке, начиная с верхнего левого угла:

```
 0──1
 │  │
 3──2
```

Нумерация рёбер соответствует следующим индексам:

* **Ребро 0**: между вершинами 0 и 1 (верхнее)
* **Ребро 1**: между вершинами 1 и 2 (правое)
* **Ребро 2**: между вершинами 2 и 3 (нижнее)
* **Ребро 3**: между вершинами 3 и 0 (левое)

#### Формирование индекса (case)

Индекс `case` для lookup table вычисляется по формуле:

```python
case = sum(vals[i] * (T**i) for i in range(4))
```

где `vals[i]` — состояние (тип) вершины с номером `i`, а `T` — общее число типов (в нашем случае 4). Это позволяет однозначно закодировать комбинацию из четырёх вершин в число в диапазоне 0…(T⁴−1).

### Алгоритм Marching Squares

### Алгоритм Marching Squares

Алгоритм Marching Squares — метод для аппроксимации изолиний на прямоугольной сетке. Для каждого квадрата вычисляется «case» на основании значений вершин (обычно бинарных), после чего из таблицы lookup table извлекаются сегменты или треугольники для отрисовки контура.

### Мульти-типовая версия

В классической версии состояния вершин — это либо `inside`, либо `outside`. Здесь каждая вершина может иметь T разных типов (0…T-1). Для каждой комбинации из 4 вершин (T^4 кейсов) строятся треугольники:

* Если все вершины одного типа — два треугольника, покрывающие весь квадрат.
* Если сегментов (границ между типами) 2 или 3 — упорядоченный полигон и его веерная триангуляция.
* Если сегментов больше — триангуляция с центром.

### Спорные зоны (aband)

При смешении нескольких типов на квадрате может образоваться зона, где нет явного преобладающего типа. Эти «спорные области» собираются в отдельный ключ `aband` и окрашиваются в **розовый**.

## Установка и запуск

1. **Клонирование репозитория**

   ```bash
   git clone <URL репозитория>
   cd <папка проекта>
   ```
2. **Создание и активация виртуального окружения**

   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/macOS
   venv\Scripts\activate     # Windows
   ```
3. **Установка зависимостей**

   ```bash
   pip install -r requirements.txt
   ```

   *requirements.txt* должен содержать:

   ```text
   pygame
   ```
4. **Запуск**

   ```bash
   python main.py
   ```

## Структура проекта

```plain
project_root/
│
├── main.py             # Основной файл с логикой Pygame
├── ms_multitype.py     # Построение lookup table и вспомогательные функции
├── requirements.txt    # Список зависимостей
└── README.md           # Этот файл
```

## Примеры использования

### Построение таблицы

```python
from ms_multitype import build_multitype_table

MULTI_TABLE = build_multitype_table()
print(len(MULTI_TABLE))  # Должно быть 4**4 = 256 кейсов
```

### Интерполяция на ребре

```python
from ms_multitype import interp

p1 = (0, 0)
p2 = (100, 0)
w1, w2 = 0.7, 0.3
print(interp(p1, p2, w1, w2))  # Пример: (70, 0)
```

## Управление

* **ЛКМ по вершине** — циклически меняет тип вершины (0→1→2→3).
* **ЛКМ по кнопке рядом с вершиной** — увеличивает вес вершины на шаг `STEP` (сброс при >0.9).
* **`STEP` и `OVERLAY_ALPHA`** можно настроить в начале файла.

## Скриншоты

Ниже представлены примеры работы программы. Сохраните скриншоты в папку `docs/screenshots/` и обновите пути при необходимости:

| Описание                                    | Изображение                                          |
| ------------------------------------------- | ---------------------------------------------------- |
| Интерфейс с различными типами вершин        | ![Разные типы вершин](docs/screenshots/example1.png) |
| Спорная область, выделенная розовым         | ![Спорная область](docs/screenshots/example2.png)    |
| Пример изменения веса вершин и триангуляции | ![Интерполяция и вес](docs/screenshots/example3.png) |

## Лицензия

Проект распространяется под лицензией MIT. См. файл `LICENSE` для подробностей.
